@(actor : String)(implicit request: RequestHeader)


<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
	$(function() {
		var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket

		var chatSocket = new WS(
				"@routes.WebsocketCommunicationController.chat(actor).webSocketURL()")
		var sendMessage = function() {
			chatSocket.send(JSON.stringify({
				text : $("#talk").val()
			}))
			$("#talk").val('')
		}

		var receiveEvent = function(event) {
			var data = JSON.parse(event.data)

			// Handle errors
			if (data.error) {
				chatSocket.close()
				$("#onError span").text(data.error)
				$("#onError").show()
				return

			} else {
				$("#onChat").show()
			}

			// Create the message element
			var el = $('<div class="message"><span></span><p></p></div>')
			$("span", el).text(data.user)
			$("p", el).text(data.message)
			$(el).addClass(data.kind)

			$('#messages').append(el)

		}

		var handleReturnKey = function(e) {
			if (e.charCode == 13 || e.keyCode == 13) {
				e.preventDefault()
				sendMessage()
			}
		}

		$("#talk").keypress(handleReturnKey)

		chatSocket.onmessage = receiveEvent

	})
</script>

<div id="onChat" class="row">

	<div class="span10" id="main">
		<div id="messages"></div>
		<textarea id="talk"></textarea>
	</div>
</div>








